packages:
  yum:
    certbot: []
    mod_ssl: []

option_settings:
  aws:elasticbeanstalk:application:environment:
    MY_ENV_VARIABLE: "some_value"

files:
  /etc/cron.d/certbot_renew:
    content: "@weekly root certbot renew\n"
    group: root
    mode: "000644"
    owner: root
  /home/ec2-user/setup.sh:
    mode: "000755"
    owner: root
    group: root
    content: |
      #!/bin/bash
      export EMAIL=$(/opt/elasticbeanstalk/bin/get-config environment -k EMAIL)
      export DOMAIN=$(/opt/elasticbeanstalk/bin/get-config environment -k DOMAIN)
      echo "sudo certbot certonly --non-interactive --email $EMAIL --agree-tos --standalone --domains $DOMAIN --force-renewal"
      sudo certbot certonly --non-interactive --email $EMAIL --agree-tos --standalone --domains $DOMAIN --force-renewal

commands:
  01_getcert:
    command: /home/ec2-user/setup.sh
    ignoreErrors: true
